# 10. 모듈형 자바스크립트 디자인 패턴

- 모듈형 = 서로 의존성이 낮은 기능들이 모듈로써 저장된 형태
- 장점 : 의존성을 제거하여 유지보수를 용이하게 만들어줌, 시스템 어느 한 부분의 변경이 다른 부분에 어떤 영향을 미칠지 쉽게 파악 가능
- 자바스크립트 es2015 이후부터 네이티브 모듈 도입 but 이전에도 모듈형 자바스크립트 작성할 수 있었음
  -> es5 문법을 사용하는 AMD, commonjs, UMD

  ## AMD (Asynchronous Module Definition)

- 모듈과 의존성 모두를 비동기적으로 로드할 수 있도록 설계된 모듈 정의 방식
- 모듈 정의 : define 메소드
  - dependencies : 정의하고 있는 모듈에서 필요로 하는 의존성 배열
  - function : 모듈의 초기화하기 위해 실행되는 함수
- 의존성 처리 : require 메소드
  - 의존성을 동적으로 가져오고자 할 때 사용

```js
define(
  moduleId,
  [dependencies],
  definition function(){

  }
)
```

```js
define("myModule", ["foo", "bar"], function (foo, bar) {
	var myModule = {
		doStuff: function () {
			console.log("hiii");
		},
	};

	return myModule;
});
```

```js
// foo,bar 외부 모듈
require("myModule", ["foo", "bar"], function (foo, bar) {
	foo.doSomething();
});
```

- AMD를 사용하면 텍스트 파일, HTML 등 겅의모든 종류의 리소스를 가져올 수 있음.
- 이를 통해, 페이지 로드시 동적으로 컴포넌트의 스타일을 정의하는 데 사용될 수 있는 템플릿 의존성을 가질 수 있음.
- require을 사용해서도 작성할 수 있음

```js
define(["./templates", "text!./template.md", "css!./tempalte.css"], function (
	templates,
	template,
) {
	console.log(templates);
});
```

```js
require(["app.myModule"], function (myModule) {
	var module = new myModule();
	module.doStuff();
});
```

- JQuery 단 하나의 파일로 제공됨
- JQuery를 사용하는 AMD 모듈을 정의하는 것은 매우 쉬움
- 비동기 모듈도 등록 가능 (requirejs, curl 등)
- nonConflict 통해서 전역 공간에 유출을 막을 수 있음

장점

- 스크립트 지연 로딩 지원
- 여러 모듈을 하나의 파일로 가져오기 위한 전송 방식 제공 -> commonjs 같은 것들은 아직 도입하지 못함
- 대체 솔루션에 비해 더 효과적 : 빌드 과정없이 브라우저에서 모듈을 로딩하는 것을 지원
- 모듈 정의가 독립적으로 이루어짐 -> 전역 네임스페이스의 오염 방지 가능
- 유용한 모듈 정의 방식에 대한 명확한 제안 제공

## CommonJS

- 서버사이드에서 모듈을 선언하는 간단한 api를 지정하는 모듈 제안
- AMD와 달리 IO, 파일 시스템, 프로미스 등 더 광범위한 부분 다룸
- AMD와 달리 모듈을 함수로 감싸는 작업이 필요하지 않음 (ex, define)
- exports : 다른 모듈에 내보내고자 하는 객체 담음
- require : 다른 모듈에서 내보낸 객체를 가져올 때 사용

```js
var lib = require("package/lib");
function foo() {
	lib.log("hello world");
}

exports.foo = foo;
```
